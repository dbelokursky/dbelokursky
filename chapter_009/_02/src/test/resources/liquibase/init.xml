<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="Create tables" author="dbelokursky" runOnChange="true">

        <!-- Drop tables if exists -->
        <sql splitStatements="true">
            DROP TABLE IF EXISTS "car" CASCADE;
            DROP TABLE IF EXISTS "engine" CASCADE;
            DROP TABLE IF EXISTS "image" CASCADE;
            DROP TABLE IF EXISTS "owner" CASCADE;
            DROP TABLE IF EXISTS "suspension" CASCADE;
            DROP TABLE IF EXISTS "transmission" CASCADE;
        </sql>

        <!-- Create tables -->
        <sql>
            CREATE TABLE transmission (
            transmission_id SERIAL PRIMARY KEY,
            name VARCHAR(200) NOT NULL
            );

            CREATE TABLE engine (
            engine_id SERIAL PRIMARY KEY,
            name VARCHAR(200) NOT NULL
            );

            CREATE TABLE suspension (
            suspension_id SERIAL PRIMARY KEY,
            name VARCHAR(200) NOT NULL
            );

            CREATE TABLE car (
            car_id SERIAL PRIMARY KEY,
            brand VARCHAR(200),
            model VARCHAR(200),
            transmission_id INTEGER REFERENCES transmission (transmission_id),
            engine_id INTEGER REFERENCES engine (engine_id),
            suspension_id INTEGER REFERENCES suspension (suspension_id),
            sold BOOLEAN,
            owner_id INTEGER REFERENCES owner(owner_id)
            );

            CREATE TABLE image(
            image_id SERIAL PRIMARY KEY,
            car_id INTEGER REFERENCES car(car_id),
            name VARCHAR,
            path VARCHAR
            );

            CREATE TABLE owner(
            owner_id SERIAL PRIMARY KEY,
            login VARCHAR(300) UNIQUE,
            password VARCHAR(300)
            );
        </sql>

        <!-- Loading of Data -->
        <sql>
            INSERT INTO car (brand, model, transmission_id, engine_id, suspension_id, sold, owner_id)
            VALUES ('BMW', 'X5', 1, 2, 1, false, 1);
            INSERT INTO car (brand, model, transmission_id, engine_id, suspension_id, sold, owner_id)
            VALUES ('Opel', 'Astra', 2, 2, 1, true, 2);
            INSERT INTO car (brand, model, transmission_id, engine_id, suspension_id, sold, owner_id)
            VALUES ('Volkswagen', 'Golf', 2, 1, 1, false, 2);
        </sql>

    </changeSet>
</databaseChangeLog>